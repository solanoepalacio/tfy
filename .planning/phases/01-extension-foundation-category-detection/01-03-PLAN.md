---
phase: 01-extension-foundation-category-detection
plan: "03"
type: execute
wave: 3
depends_on:
  - "01-02"
files_modified: []
autonomous: false
requirements:
  - CORE-01
  - CORE-02
  - CORE-03
  - CATD-01
  - CATD-02

must_haves:
  truths:
    - "Extension loads in Chrome via developer mode without manifest errors"
    - "Entering API key in popup and saving it persists after popup close"
    - "Navigating to youtube.com/watch?v=... logs [TFY] category ID to DevTools console"
    - "Navigating to a second YouTube video (SPA nav, no reload) logs [TFY] for the new video"
  artifacts:
    - path: "manifest.json"
      provides: "Loadable MV3 extension manifest"
    - path: "service-worker.js"
      provides: "API proxy + navigation relay"
    - path: "content-script.js"
      provides: "Video ID extraction + category log"
    - path: "popup.html"
      provides: "API key input UI"
  key_links:
    - from: "User entering API key in popup"
      to: "chrome.storage.local"
      via: "popup.js chrome.storage.local.set"
      pattern: "storage\\.local\\.set"
    - from: "YouTube navigation"
      to: "console log"
      via: "webNavigation → YT_NAVIGATION → GET_VIDEO_CATEGORY → googleapis.com → console.log"
      pattern: "\\[TFY\\]"
---

<objective>
Human verification that the complete Phase 1 plumbing chain works end-to-end in a real Chrome browser: extension loads, API key persists, category ID is logged on video navigation including SPA navigation.

Purpose: Unit tests cannot validate Chrome extension integration — only loading the extension in a real browser can confirm the manifest is valid, the service worker activates, the content script injects, and the message relay produces correct console output.
Output: Confirmed working extension (or documented issues for gap closure).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: End-to-end verification in Chrome</name>
  <action>Human verifies the complete extension pipeline works in a real Chrome browser. No automated action — this checkpoint follows Plans 01 and 02 which built all the code.</action>
  <what-built>
Complete Chrome MV3 extension with:
- manifest.json (MV3, service worker, content script, popup)
- service-worker.js (YouTube Data API proxy + SPA navigation relay)
- content-script.js (video ID extraction, category request, console logging)
- popup.html + popup.js (API key entry persisted to chrome.storage.local)
- icons/icon16.png, icon48.png, icon128.png
  </what-built>
  <how-to-verify>
**Step 1: Load the extension**
1. Open Chrome and navigate to chrome://extensions
2. Enable "Developer mode" (toggle, top-right)
3. Click "Load unpacked" and select the repo root directory (the folder containing manifest.json)
4. Expected: Extension appears in list as "TFY — Topic Focused YouTube" with no error badges

**Step 2: Configure API key**
1. Click the TFY extension icon in Chrome toolbar (or puzzle piece → TFY)
2. Expected: Popup opens showing heading "TFY — Topic Focused YouTube" and an API key input
3. Enter your YouTube Data API v3 key in the input field
4. Click "Save" — status should show "Saved."
5. Close the popup and reopen it — key should still be populated
6. Expected: API key persists across popup close/reopen

**Step 3: Test category detection on initial load**
1. Open DevTools on any existing tab (F12) OR open a new tab
2. Navigate to any YouTube watch page, e.g.: https://www.youtube.com/watch?v=dQw4w9WgXcQ
3. Open DevTools console (F12 → Console tab) — filter by "[TFY]" if needed
4. Expected console output (within 2-3 seconds):
   - `[TFY] Detected video: dQw4w9WgXcQ`
   - `[TFY] Video dQw4w9WgXcQ → category ID: 10` (or any numeric category ID)

**Step 4: Test SPA navigation (no page reload)**
1. From the current YouTube watch page, click a video in the sidebar (do NOT open in new tab)
2. YouTube navigates to the new video without a full page reload
3. Expected console output for the new video (within 2-3 seconds):
   - `[TFY] Detected video: {newVideoId}`
   - `[TFY] Video {newVideoId} → category ID: {N}`

**Step 5: Verify service worker is active**
1. Go to chrome://extensions, click "Service Worker" link under the TFY extension
2. DevTools opens on the service worker — check for any errors in Console tab
3. Expected: No errors. Service worker shows as active or activating.

**Troubleshooting:**
- If no [TFY] logs appear: check service worker console for errors (chrome://extensions → Service Worker). Common cause: API key not saved, or content script didn't inject (check content_scripts.matches in manifest.json)
- If API call fails: check service worker console for "YouTube API 403" (quota exceeded or invalid key) or "YouTube API 400" (malformed request)
- If extension has manifest errors: click "Errors" badge in chrome://extensions to see details
  </how-to-verify>
  <verify>Human-only verification — no automated command available for live browser testing.</verify>
  <done>All 5 steps pass: extension loads, API key persists, category ID logged on first video load, category ID logged on SPA navigation to second video, no service worker errors.</done>
  <resume-signal>Type "approved" if all 5 steps pass. If issues found, describe which step failed and what the console/error showed.</resume-signal>
</task>

</tasks>

<verification>
This plan IS the verification step. The checkpoint task is the sole deliverable.
</verification>

<success_criteria>
1. Extension loads in Chrome developer mode without manifest errors
2. API key popup works — saves on click, persists on reopen
3. Navigating to youtube.com/watch?v=... logs [TFY] with a numeric category ID
4. Navigating between YouTube videos via sidebar click (SPA nav) logs [TFY] for each new video
5. Service worker console shows no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-extension-foundation-category-detection/01-03-SUMMARY.md`
</output>
